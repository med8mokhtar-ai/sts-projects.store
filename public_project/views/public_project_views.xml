<?xml version="1.0" encoding="utf-8"?>
<odoo>
        <record id="view_public_project_search" model="ir.ui.view">
        <field name="name">public.project.search</field>
        <field name="model">public.project</field>
        <field name="arch" type="xml">
            <search string="Recherche Marché Public">
                <!-- Champ de recherche générique -->
                <field name="numero_marche" string="N° Marché" />
                <field name="name" string="Nom du Marché" />
                <field name="titulaire_id" string="Titulaire" />
                <field name="autorite_contractante_id" string="Autorité Contractante" />

                <!-- Filtres prédéfinis -->
                <filter string="Mes Marchés" name="my_projects" domain="[('user_id', '=', uid)]" />

                <filter string="En Cours" name="active_projects"
                    domain="[('state', '=', 'en_cours')]" />

                <filter string="Signés" name="signed_projects" domain="[('state', '=', 'signe')]" />

                <filter string="Réception Provisoire" name="reception_provisoire_projects"
                    domain="[('state', '=', 'reception_provisoire')]" />

                <filter string="Achevés" name="completed_projects"
                    domain="[('state', 'in', ['acheve', 'reception_definitive'])]" />

                <separator />
                <filter string="Marchés de Travaux" name="type_travaux"
                    domain="[('type_marche', '=', 'travaux')]" />

                <filter string="Marchés de Fournitures" name="type_fournitures"
                    domain="[('type_marche', '=', 'fournitures')]" />

                <filter string="Marchés de Services" name="type_services"
                    domain="[('type_marche', '=', 'services')]" />

                <!-- Filtres financiers -->
                <separator />
                <filter string="Montant &gt; 1M" name="high_amount"
                    domain="[('montant_contrat', '&gt;', 1000000)]" />

                <filter string="Montant &lt; 100K" name="low_amount"
                    domain="[('montant_contrat', '&lt;', 100000)]" />
                <separator />
                <group>
                    <filter string="Titulaire"
                        name="group_titulaire"
                        context="{'group_by': 'titulaire_id'}" />

                    <filter string="Autorité Contractante"
                        name="group_autorite"
                        context="{'group_by': 'autorite_contractante_id'}" />

                    <filter string="Date d'entrée en vigueur"
                        name="group_date_entree"
                        context="{'group_by': 'date_entree_vigueur'}" />

                    <filter string="État"
                        name="group_state"
                        context="{'group_by': 'state'}" />
                </group>

            </search>
        </field>
    </record>

    <record id="view_public_project_list" model="ir.ui.view">
        <field name="name">public.project.list</field>
        <field name="model">public.project</field>
        <field name="arch" type="xml">
            <!-- decoration-success="delai_restant &gt; 30"
                decoration-warning="delai_restant &gt;= 0"
                decoration-danger="delai_restant &lt; 0" -->
            <list string="Projets Publics" decoration-info="state  == 'signe'">

                <!-- Colonnes principales -->
                <field name="numero_marche" string="N° Marché" />
                <field name="name" string="Objet du Projet" />
                <field name="titulaire_id" string="Titulaire" />
                <field name="autorite_contractante_id" string="Autorité" />

                <!-- Colonnes état et responsabilité -->
                <field name="state" string="État" widget="badge"
                    decoration-success="state in ['acheve', 'reception_definitive']"
                    decoration-warning="state in ['en_cours', 'reception_provisoire']"
                    decoration-danger="state == 'resilie'"
                    decoration-info="state  == 'signe'" />
                    <!-- options="{'classes': {'en_cours': 'bg-warning', 'reception_provisoire': 'bg-info', 'acheve': 'bg-success'}}" /> -->

                <field name="user_id" string="Responsable" widget="many2one_avatar_user" />
                <field name="currency_id" column_invisible="1" />

                <!-- Colonnes dates et délais -->
                <field name="date_debut_reel" string="Début" widget="date" />
                <field name="date_fin_prevue" string="Fin Prévue" widget="date" />
                <!-- <field name="delai_restant" string="Jours Restants" widget="integer"
                    options="{'negative_class': 'text-danger', 'positive_class': 'text-success'}" /> -->

                <!-- Colonnes financières -->
                <field name="taux_decaissement" widget="progressbar"
                    options="{'editable': true, 'max_value': 100}" readonly="1" />
                <field name="montant_contrat_revise" widget="monetary" options="{'currency_field': 'currency_id'}" sum="Total" string="Montant"/>
            </list>
        </field>
    </record>
    <record id="view_public_project_form" model="ir.ui.view">
        <field name="name">public.project.form</field>
        <field name="model">public.project</field>
        <field name="arch" type="xml">
            <form string="Projet Public" class="o_form_project_project">
                <header>
                    <!-- Status bar -->
                    <field name="state" widget="statusbar" options="{'clickable': '1'}" />

                    <!-- Boutons d'action -->

                </header>

                <sheet string="Détails du Marché">
                    <!-- Boutons statistiques -->
                    <div class="oe_button_box" name="button_box">
                        <!-- Financial Situation Button -->
                        <button name="action_view_financial" type="object" class="oe_stat_button"
                            icon="fa-line-chart" invisible="analytic_account_id == False"
                            context="{'search_default_group_by_date': 1, 'search_default_group_by_category': 1}">
                            <div class="o_form_field o_stat_info">
                                <span class="o_stat_value">
                                    <field name="currency_id" invisible="1" />
                                    <field name="total_decaissements" widget="monetary"
                                        options="{'currency_field': 'currency_id'}" />
                                </span>
                                <span class="o_stat_text">Décaissements</span>
                            </div>
                        </button>


                        <!-- Amendments Button -->
                        <button name="action_view_avenants" type="object" class="oe_stat_button"
                            icon="fa-file-text">
                            <div class="o_form_field o_stat_info">
                                <span class="o_stat_value">
                                    <field name="avenant_count" widget="integer" />
                                </span>
                                <span class="o_stat_text">Avenants</span>
                            </div>
                        </button>


                    </div>

                    <!-- Titre -->
                    <div class="oe_title">
                        <h1>
                            <field name="numero_marche" widget="text" class="o_text_overflow"
                                placeholder="Numéro du marché" nolabel="1" />
                        </h1>
                        <h3>
                            <field name="name" widget="text" class="o_text_overflow"
                                placeholder="Objet du projet" nolabel="1" />
                        </h3>
                    </div>
                    <group>
                        <group string="Information Générale">
                            <field name="user_id" string="Responsable" widget="many2one_avatar_user" />
                            <field name="analytic_account_id"
                                groups="analytic.group_analytic_accounting"
                                options="{'no_create': True}" />
                        </group>
                        <group string="Type et Passation">
                            <field name="type_marche" />
                            <field name="mode_passation" />
                        </group>

                        <!-- After the "Parties Prenantes" group (which you need to add) -->
                        <group string="Parties Prenantes">
                            <field name="titulaire_id"
                                options="{'no_create': True, 'no_open': True}" />
                            <field name="autorite_contractante_id"
                                options="{'no_create': True, 'no_open': True}" />

                            <field name="commission_pasation_id"
                                options="{'no_create': True, 'no_open': True}" />
                        </group>
                        <group string="Cautions et frais">
                            <field name="montant_caution_bonne_execution" widget="monetary"
                                options="{'currency_field': 'currency_id'}" />
                            <field name="montant_caution_avance_demarrage" widget="monetary"
                                options="{'currency_field': 'currency_id'}" />
                            <field name="montant_frais_banque" widget="monetary"
                                options="{'currency_field': 'currency_id'}" />
                        </group>

                        <!-- In the "Situation Financière" group, add after existing fields -->

                        <group string="Dates Contractuelles">
                            <label for="delai_contractuel_value" />
                            <div>
                                <field name="delai_contractuel_value" style="width: 3rem;" />
                                <field name="delai_contractuel_unit" class="oe_inline" />
                            </div>
                            
                            <field name="date_entree_vigueur" required="1" />
                            <field name="date_signature"
                                required="date_entree_vigueur==date_signature" />
                            <field name="date_notification"
                                required="date_entree_vigueur==date_notification" />
                            <field name="date_remise_site"
                                required="date_entree_vigueur==date_remise_site" />
                            <field name="date_ordre_debut"
                                required="date_entree_vigueur==date_ordre_debut" />
                            <field name="date_paiement_avance"
                                required="date_entree_vigueur==date_paiement_avance" />
                            <field name="date_debut_reel" readonly="1" string="Date Début Réel" />
                            <field name="date_fin_prevue" />
                            <label for="delai_contractuel_revise" />
                            <div>
                                <field name="delai_contractuel_revise" style="width: 3rem;" />
                                <field name="delai_contractuel_unit" class="oe_inline" readonly="1"/>
                            </div>
                        </group>


                        <group string="Situation Financière">
                            <field name="montant_contrat" required="1" widget="monetary"
                                options="{'currency_field': 'currency_id'}" />

                            <field name="montant_contrat_revise" widget="monetary"
                                options="{'currency_field': 'currency_id'}" />

                            <field name="montant_avance_demarrage" widget="monetary"
                                options="{'currency_field': 'currency_id'}" />

                            <field name="total_decaissements" readonly="1" widget="monetary"
                                options="{'currency_field': 'currency_id'}" />
                            <field name="solde_a_recevoir" readonly="1" widget="monetary"
                                options="{'currency_field': 'currency_id'}" />
                        </group>


                        <group string="Avancement et Performance">
                            <field name="taux_decaissement"
                                widget="progressbar"
                                options="{'editable': true, 'max_value': 100}"
                                readonly="1" />

                            

                            
                        </group>

                    </group>


                    <notebook>

                        <page name="reception" string="Réception et Livraison" invisible="state not in ['reception_provisoire','reception_definitive']">
                            <group>
                                <group string="Réception Provisoire">
                                    <field name="date_reception_provisoire"
                                        required="state == 'reception_provisoire'" invisible="state != 'reception_provisoire'"/>
                                </group>
                                <group string="Réception Définitive">
                                    <field name="date_reception_definitive"
                                        required="state == 'reception_definitive'" invisible="state != 'reception_definitive'"/>
                                </group>
                            </group>
                        </page>

                        <page name="observations" string="Observations et Suivi">
                            <field name="observations_suivi" nolabel="1"
                                placeholder="Observations techniques..." />

                        </page>
                    </notebook>
                </sheet>
                <chatter reload_on_follower="True" />
            </form>
        </field>
    </record>

</odoo>