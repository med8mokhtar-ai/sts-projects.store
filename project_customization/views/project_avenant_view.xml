<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_project_avenant_filter" model="ir.ui.view">
        <field name="name">project.avenant.filter</field>
        <field name="model">project.avenant</field>
        <field name="arch" type="xml">
            <search string="Search Project">
                <filter string="Ordre service" name="ordre_service" domain="[('type_avenant', '=', 'ordre_service')]" />
                <filter string="Avenant" name="avenant" domain="[('type_avenant', '=', 'avenant')]" />
                <field name="name" string="Nom"/>
                <field name="numero_marche" string="Numéro"/>
                <field name="autorite_contractante" string="Autorité contractante"/>
                <field name="titulaires" string="Titulaire"/>
                <separator/>

                <group expand="0" string="Group By">
                    <filter string="Type d'avenant" name="group_avenant" context="{'group_by': 'type_avenant'}"/>
                    <filter string="Type du marché" name="Type" context="{'group_by': 'market_type_id'}"/>
                    <filter string="Autorité contractante" name="Autorité" context="{'group_by': 'autorite_contractante'}"/>
                    <filter string="Titulaire" name="Titulaire" context="{'group_by': 'titulaires'}"/>
                </group>
            </search>
        </field>
    </record>
    <record id="project_sharing_project_avenant_view_kanban" model="ir.ui.view">
        <field name="name">project.sharing.project.avenant.view.kanban</field>
        <field name="model">project.avenant</field>
        <field name="priority">999</field>
        <field name="groups_id" eval="[(4, ref('base.group_portal')), (4, ref('base.group_user'))]"/>
        <field name="arch" type="xml">
            <kanban class="o_kanban_small_column o_kanban_project_tasks" sample="1" default_group_by="state" archivable="0" import="0" records_draggable="false" groups_draggable="false" quick_create="false" group_create="false" group_edit="false" group_delete="false">
                <field name="currency_id"/>
                <field name="amount"></field>
                <field name="color"/>
                <!-- <field name="priority"/> -->
                <field name="state" options='{"group_by_tooltip": {"description": "Description"}}'/>
                <!-- <field name="project_id"/> -->
                <field name="numero_marche"></field>
                <field name="titulaires" string="Titulaire" widget="many2many_tags"/>
                <!-- <field name="closed_subtask_count"/> -->
                <field name="percentage"/>
                <field name="autorite_contractante" />
                <!-- <field name="has_late_and_unreached_milestone"/> -->
                <progressbar field="state" colors='{"valide": "success"}'/>
                <templates>

                    <t t-name="kanban-menu" t-if="!selection_mode">
                        <div role="separator" class="dropdown-divider"></div>
                        <ul class="oe_kanban_colorpicker" data-field="color"/>
                    </t>
                    <t t-name="kanban-box">
                        <!-- <div t-attf-class="{{!selection_mode ? 'oe_kanban_color_' + kanban_getcolor(record.color.raw_value) : ''}} oe_kanban_card oe_kanban_global_click"> -->
                        <div t-attf-class="{{!selection_mode ? 'oe_kanban_color_' + kanban_getcolor(record.color.raw_value) : ''}} oe_kanban_card oe_kanban_global_click">
                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <!-- <s t-if="!record.active.raw_value"> -->
                                            <field name="name"/>
                                            <field name="date"/>
                                            <!-- </s> -->

                                        </strong>
                                        <!-- <span t-if="record.project_id.raw_value">
                                                <br/>
                                                <field name="project_id"/>
                                            </span> -->
                                        <span t-if="record.numero_marche.raw_value">
                                            <br/>
                                            <label for="titulaires">Numéro du marché: </label>
                                            <field name="numero_marche"/>
                                        </span>
                                        <span t-if="record.autorite_contractante.raw_value">
                                            <br/>
                                            <label for="autorite_contractante">Autorité: </label>
                                            <field name="autorite_contractante"/>
                                        </span>
                                        <br />
                                        <t t-if="record.titulaires.value">
                                            <label for="titulaires">Titulaire: </label>
                                            <field name="titulaires" string="Titulaire" widget="many2many_tags"/>
                                        </t>
                                        <br />
                                        <t t-if="record.type_avenant.value">
                                            <label for="type_avenant">Type: </label>
                                            <!-- <b> -->
                                            <field name="type_avenant"/>
                                            <!-- </b> -->

                                        </t>
                                        <br />
                                        <t t-if="record.amount.value">
                                            <label for="amount">Montant: </label>
                                            <!-- <b> -->
                                            <field name="amount" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                            <!-- </b> -->

                                        </t>
                                        <br/>
                                        <t t-if="record.percentage.value">
                                            <label for="percentage">Pourcentage: </label>
                                            <!-- <b> -->
                                            <field name="percentage" widget="progressbar_no_rounding"/>

                                            <!-- </b> -->

                                        </t>

                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    <record id="project_project_avenant_view_kanban" model="ir.ui.view">
        <field name="name">project.project.avenant.view.kanban</field>
        <field name="model">project.avenant</field>
        <field name="priority">999</field>
        <field name="groups_id" eval="[(4, ref('base.group_portal')), (4, ref('base.group_user'))]"/>
        <field name="arch" type="xml">
            <kanban class="o_kanban_small_column o_kanban_project_tasks" sample="1" default_group_by="state" archivable="0" import="0">

                <field name="color"/>
                <field name="currency_id"/>
                <field name="amount"></field>
                <field name="state" options='{"group_by_tooltip": {"description": "Description"}}'/>
                <!-- <field name="project_id"/> -->
                <field name="numero_marche"></field>

                <field name="titulaires" string="Titulaire" widget="many2many_tags"/>
                <field name="percentage"/>
                <!-- <field name="closed_subtask_count"/> -->
                <!-- <field name="subtask_count"/> -->
                <field name="autorite_contractante" />
                <!-- <field name="has_late_and_unreached_milestone"/> -->
                <progressbar field="state" colors='{"valide": "success"}'/>
                <templates>

                    <t t-name="kanban-menu" t-if="!selection_mode">
                        <div role="separator" class="dropdown-divider"></div>
                        <ul class="oe_kanban_colorpicker" data-field="color"/>
                    </t>
                    <t t-name="kanban-box">
                        <!-- <div t-attf-class="{{!selection_mode ? 'oe_kanban_color_' + kanban_getcolor(record.color.raw_value) : ''}} oe_kanban_card oe_kanban_global_click"> -->
                        <div t-attf-class="{{!selection_mode ? 'oe_kanban_color_' + kanban_getcolor(record.color.raw_value) : ''}} oe_kanban_card oe_kanban_global_click">
                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <!-- <s t-if="!record.active.raw_value"> -->
                                            <field name="name"/>
                                            <field name="date"/>
                                            <!-- </s> -->

                                        </strong>
                                        <!-- <span t-if="record.project_id.raw_value">
                                                <br/>
                                                <field name="project_id"/>
                                            </span> -->
                                        <!-- <span t-if="record.numero_marche.raw_value">
                                                <br/>
                                                <label for="titulaires">Numéro du marché: </label>
                                                <field name="numero_marche"/>
                                            </span> -->
                                        <span t-if="record.autorite_contractante.raw_value">
                                            <br/>
                                            <label for="autorite_contractante">Autorité: </label>
                                            <field name="autorite_contractante"/>
                                        </span>
                                        <br />
                                        <t t-if="record.titulaires.value">
                                            <label for="titulaires">Titulaire: </label>
                                            <field name="titulaires" string="Titulaire" widget="many2many_tags"/>
                                        </t>
                                        <br />
                                        <t t-if="record.type_avenant.value">
                                            <label for="type_avenant">Type: </label>
                                            <!-- <b> -->
                                            <field name="type_avenant"/>
                                            <!-- </b> -->

                                        </t>
                                        <br />
                                        <t t-if="record.amount.value">
                                            <label for="amount">Montant: </label>
                                            <!-- <b> -->
                                            <field name="amount" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                            <!-- </b> -->

                                        </t>
                                        <br/>
                                        <t t-if="record.percentage.value">
                                            <label for="percentage">Pourcentage: </label>
                                            <!-- <b> -->
                                            <field name="percentage" widget="progressbar_no_rounding"/>

                                            <!-- </b> -->

                                        </t>

                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Form View -->
    <record id="project_avenant_form" model="ir.ui.view">
        <field name="name">project.avenant.form</field>
        <field name="model">project.avenant</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button class="oe_highlight" string="Soumettre" type="object" name="action_sent" invisible="state!='draft'" groups="project_customization.group_project_autorite"/>
                    <button class="oe_highlight" string="Valider" type="object" name="action_confirm" invisible="state!='sent'" groups="project.group_project_manager"/>
                    <button class="oe_highlight" string="Remettre un brouillon" type="object" name="action_back_to_draft" invisible="state!='sent'" groups="project.group_project_manager"/>
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_title pe-0">
                        <h1 class="d-flex flex-row justify-content-between">
                            <field name="name" class="o_task_name text-truncate" readonly="state in ('sent','valide')"/>
                            <field name="date" class="o_task_name text-truncate" readonly="state in ('sent','valide')"/>
                            <!-- <field name="state" widget="project_feedback_state_selection" options="{'is_toggle_mode': false}"/> -->
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="project_id" invisible="1"/>
                            <field name="numero_marche"></field>
                            <field name="market_type_id" options="{'no_open': true, 'no_create': true, 'no_edit': true}"/>

                            <field name='currency_id' invisible="1"/>
                            <field name="montant_initial" widget="monetary" options="{'currency_field': 'currency_id'}"/>



                        </group>
                        <group>
                            <field name='autorite_contractante' options="{'no_open': true, 'no_create': true, 'no_edit': true}"/>
                            <!-- <field name="retard_constate" hepl="Délai consommé - Délai prévisionnel"/> -->
                            <field name="titulaires" string="Titulaire" widget="many2many_tags" options="{'no_open': true, 'no_create': true, 'no_edit': true}"/>
                            <field name="company_id" invisible="1" />
                            <field name="funding_mode_ids" widget="many2many_tags"/>
                        </group>
                    </group>
                    <group>
                        <group string="a saisir">
                            <field name="type_avenant" readonly="state != 'draft'" class="oe_inline"/>
                            <field name="funding_mode_ids_a" widget="many2many_tags" readonly="state != 'draft'"/>
                            <field name="amount" readonly="state != 'draft'" widget='monetary' class="oe_inline" options="{'currency_field': 'currency_id'}" />
                            <field name="percentage" widget="progressbar_no_rounding" class="oe_inline" options="{'editable': true}" />
                            <field name="regime_fiscal" readonly="state != 'draft'"/>
                            <field name="credit_impot" invisible="regime_fiscal==False" string="Credit impot" readonly="state != 'draft'"/>
                        </group>
                        <group string="Dates">
                            <field name="delai_execution" />
                            <field name="date_signature" />
                            <field name="date_notification" />
                            <field name="date_noti_deb_ex" />
                        </group>
                        <!-- <group string="Devise" name="devise">
                            
                        </group> -->
                    </group>
                    <notebook>
                        <page name="description" string="Description">
                            <field name="description" placeholder="Ecrivez ..." readonly="state != 'draft'" />
                        </page>
                    </notebook>
                </sheet>
                <!-- <div class="oe_chatter" disable_attachment_box="1"> -->
                <div class="oe_chatter">
                    <!--                        <field name="message_follower_ids" options="{'open_attachments': False}"/>-->
                    <field name="message_ids" />
                </div>
            </form>
        </field>
    </record>
    <record id="project_avenant_pivot_view" model="ir.ui.view">
        <field name="name">project.avenant.pivot.view</field>
        <field name="model">project.avenant</field>
        <field name="arch" type="xml">
            <pivot string="Analyse des avenants">
                <field name="project_id" type="row"/>
                <field name="amount" type="measure"/>
            </pivot>
        </field>
    </record>
    <!--project.update customized graph view-->
    <record id="project_avenant_view_graph" model="ir.ui.view">
        <field name="name">project.avenant.view.graph</field>
        <field name="model">project.avenant</field>
        <field name="arch" type="xml">
            <!-- stacked="0"-->
            <graph string="Analyse des avenants" sample="1">
                <field name="project_id"/>
                <!-- x -->
                <field name="amount" type="measure"/>
                <!-- y -->
            </graph>
        </field>
    </record>

    <!-- Tree View -->
    <record id="project_avenant_tree" model="ir.ui.view">
        <field name="name">project.avenant.tree</field>
        <field name="model">project.avenant</field>
        <field name="arch" type="xml">
            <tree create="1">
                <field name="currency_id" column_invisible="true" />
                <field name="project_id"/>
                <field name="market_type_id"/>
                <field name="autorite_contractante"/>
                <field name="titulaires" string="Titulaire" widget="many2many_tags"/>
                <field name="type_avenant"/>
                <field name="funding_mode_ids" widget='many2many_tags'/>
                <field name="date"/>
                <field name="montant_initial" optional="show" />
                <field name="amount" sum="Total" optional="show"/>
                <field name="percentage" widget="progressbar_no_rounding" sum="Total" optional="show"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record id="project_avenant_filter" model="ir.ui.view">
        <field name="name">project_avenant.filter</field>
        <field name="model">project.avenant</field>
        <field name="arch" type="xml">
            <search>
                <filter string="Ordre service" name="ordre_service" domain="[('type_avenant', '=', 'ordre_service')]" />
                <filter string="Avenant" name="avenant" domain="[('type_avenant', '=', 'avenant')]" />
                <group string="Group By..." expand="0" name="marche">
                    <filter string="Type d'avenant" name="group_avenant" context="{'group_by': 'type_avenant'}"/>
                </group>

            </search>

        </field>
    </record>

    <!-- Action Window -->
    <record id="action_project_avenant" model="ir.actions.act_window">
        <field name="name">Analyse des avenants</field>
        <field name="res_model">project.avenant</field>
        <field name="search_view_id" ref="view_project_avenant_filter"/>
        <field name="view_mode">kanban,tree,form,graph,pivot</field>
    </record>
    <record id="action_project_sharing_avenant" model="ir.actions.act_window">
        <field name="name">Avenant</field>
        <field name="res_model">project.avenant</field>
        <field name="search_view_id" ref="project_avenant_filter"/>
        <field name="view_mode">tree,form,kanban</field>
    </record>

    <record id="project_sharing_kanban_action_view" model="ir.actions.act_window.view">
        <field name="view_mode">kanban</field>
        <field name="act_window_id" ref="project_customization.action_project_sharing_avenant"/>
        <field name="view_id" ref="project_customization.project_sharing_project_avenant_view_kanban"/>
    </record>
    <record id="project_kanban_action_view" model="ir.actions.act_window.view">
        <field name="view_mode">kanban</field>
        <field name="act_window_id" ref="project_customization.action_project_avenant"/>
        <field name="view_id" ref="project_customization.project_project_avenant_view_kanban"/>
    </record>
</odoo>
