<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!--Post control form-->
        <record id="post_control_custom_form" model="ir.ui.view">
            <field name="name">project.project.post.control.form</field>
            <field name="model">project.project</field>
            <field name="arch" type="xml">
                <form string="Contrôle a posteriori" class="o_form_project_project"
                    js_class="project_form">
                    <sheet string="Contrôle a posteriori">
                        <field name="hide_bailleur_fields" invisible="1"/>
                        <group>
                            <group>
                                <field name="numero_marche" string="Marché n°" readonly="True" />
                                <field name="commission_passation"
                                    string="Commission de Passation des Marchés"
                                    nolabel="0" readonly="True" />
                                <field name='name' string="Objet du marché" readonly="True" />
                                <field name='handling_mode_ids' string="Mode de passation"
                                    widget="many2many_tags"
                                    readonly="True" />
                                <field name='market_type_id' string="Type de marché" required="True"
                                    nolabel="0"
                                    readonly="True" />
                                <field name="market_type_name" invisible="True" readonly="True" />
                                <field name="currency_id" invisible="True" />

                            </group>
                            <group>
                                <field name='autorite_contractante' string="Autorité Contractante"
                                    required="market_type_name != 'Projet interne'"
                                    invisible="market_type_id and market_type_name == 'Projet interne'"
                                    readonly="True" />
                                <field name='funding_mode_ids' string="Financement"
                                    widget="many2many_tags"
                                    readonly="True" />
                                <field name="titulaires" string="Attributaire"
                                    widget="many2many_tags" readonly="True" />
                                <field name="secteur_id" readonly="True" />
                                <field name="budget" string="Montant"
                                    help="Montant initial + Avenants" widget="monetary"
                                    options="{'currency_field': 'currency_id'}" readonly="True" />
                                <field name="delai_execution" string="Délai(jours)" readonly="True" />
                            </group>
                        </group>
                        <group>
                            <field name="completion_rate" widget="progressbar"
                                options="{'max_field': 100}"
                                string="Taux de remplissage" />
                        </group>


                        <notebook string="Fiche de Contrôle">

                            <page string="Phase PPM">
                                <group>
                                    <group>
                                        <field name="ppm_inscription" />
                                    </group>
                                </group>
                            </page>

                            <page string="Phase AMI"
                                invisible="market_type_name != 'Prestations intellectuelles'">
                                <group>
                                    <group>
                                        <field name="ami_conformity" />
                                        <field name="ami_cpmp_call" />
                                        <field name="ami_cpmp_approval" />
                                        <field name="ami_donor_approval" invisible="hide_bailleur_fields"/>
                                        <field name="ami_publication" />
                                    </group>
                                </group>

                            </page>

                            <page string="Phase DAO"
                                invisible="market_type_name == 'Prestations intellectuelles'">
                                <group>
                                    <group>
                                        <field name="dao_conformity" />
                                        <field name="dao_cpmp_call" />
                                        <field name="dao_cpmp_approval" />
                                        <field name="dao_donor_approval" invisible="hide_bailleur_fields"/>
                                        <field name="dao_publication" />
                                    </group>
                                </group>

                            </page>

                            <page string="Evaluation MI"
                                invisible="market_type_name != 'Prestations intellectuelles'">
                                <group>
                                    <group>
                                        <field name="mi_opening" />
                                        <field name="mi_commission" />
                                        <field name="mi_report" />
                                        <field name="mi_cpmp_call" />

                                    </group>
                                    <group>
                                        <field name="mi_cpmp_approval" />
                                        <field name="mi_donor_approval" invisible="hide_bailleur_fields"/>
                                        <field name="mi_shortlist_publication" />
                                    </group>
                                </group>

                            </page>

                            <page string="Evaluation"
                                invisible="market_type_name == 'Prestations intellectuelles'">
                                <group>
                                    <group>
                                        <field name="eval_opening" />
                                        <field name="eval_commission" />
                                        <field name="eval_report" />
                                        <field name="eval_cpmp_call" />
                                        <field name="eval_cpmp_approval" />
                                        <field name="eval_preliminary" />
                                        <field name="eval_conformite" />
                                        <field name="eval_qualification" />
                                    </group>
                                    <group>
                                        <field name="eval_adjustments" />
                                        <field name="eval_less_disadvantaged" />
                                        <field name="eval_donor_approval" invisible="hide_bailleur_fields"/>
                                        <field name="eval_publication" />
                                        <field name="eval_recours" />
                                        <field name="eval_notification" />
                                    </group>
                                </group>

                            </page>

                            <page string="DP"
                                invisible="market_type_name != 'Prestations intellectuelles'">
                                <group>
                                    <group>
                                        <field name="dp_conformity" />
                                        <field name="dp_cpmp_call" />
                                        <field name="dp_cpmp_approval" />
                                        <field name="dp_donor_approval" invisible="hide_bailleur_fields"/>
                                        <field name="dp_transmission" />
                                    </group>
                                </group>

                            </page>

                            <page string="Evaluation Technique"
                                invisible="market_type_name != 'Prestations intellectuelles'">
                                <group>
                                    <group>
                                        <field name="tech_opening" />
                                        <field name="tech_responded" />
                                        <field name="tech_not_responded" />
                                        <field name="tech_commission" />
                                        <field name="tech_report" />
                                        <field name="tech_cpmp_call" />

                                    </group>
                                    <group>
                                        <field name="tech_cpmp_approval" />
                                        <field name="tech_donor_approval" invisible="hide_bailleur_fields"/>
                                        <field name="tech_qualified" />
                                        <field name="tech_unqualified" />
                                        <field name="tech_notification" />
                                        <field name="tech_invitation" />
                                    </group>
                                </group>

                            </page>

                            <page string="Evaluation Financiere"
                                invisible="market_type_name != 'Prestations intellectuelles'">
                                <group>
                                    <group>
                                        <field name="fin_opening" />
                                        <field name="fin_cpmp_call" />
                                        <field name="fin_cpmp_approval" />
                                        <field name="fin_donor_approval" invisible="hide_bailleur_fields"/>

                                    </group>
                                    <group>
                                        <field name="fin_publication" />
                                        <field name="fin_recours" />
                                        <field name="fin_notification" />
                                    </group>
                                </group>

                            </page>

                            <page string="Phase Marché">
                                <group>
                                    <group>
                                        <field name="market_conformity"
                                            invisible="market_type_name != 'Prestations intellectuelles'" />
                                        <field name="works_market_conformity"
                                            invisible="market_type_name == 'Prestations intellectuelles'" />
                                        <field name="market_cpmp_call" />
                                        <field name="market_cpmp_approval" />
                                        <field name="market_donor_approval" invisible="hide_bailleur_fields"/>

                                    </group>
                                    <group>
                                        <field name="market_final_publication" />
                                        <field name="contract_signature" />
                                        <field name="ac_approval" />
                                        <field name="market_notification" />
                                    </group>
                                </group>

                            </page>

                            <page string="Observations">
                                <field name="additional_observations" />
                            </page>
                        </notebook>


                    </sheet>
                </form>
            </field>
        </record>

        <!--Post
        control list-->
        <record id="post_control_custom_tree" model="ir.ui.view">
            <field name="name">project.project.post.control.tree</field>
            <field name="model">project.project</field>
            <field name="arch" type="xml">
                <tree string="Marchés" export_xlsx="1" create="false" edit="true" delete="false"
                    default_order="numero_marche asc"
                    multi_edit="false">
                    <field name="numero_marche" string="Marché n°" />
                    <field name='name' string="Objet du marché" />
                    <field name="commission_passation" string="Commission de Passation des Marchés" />
                    <field name='handling_mode_ids' string="Mode de passation"
                        widget="many2many_tags" />
                    <field name='market_type_id' string="Type de marché" />
                    <field name='autorite_contractante' string="Autorité Contractante" />
                    <field name='funding_mode_ids' widget="many2many_tags" string="Financement" />
                    <field name="titulaires" string="Attributaire" widget="many2many_tags" />
                    <field name='currency_id' column_invisible="True" />
                    <field name="budget" string="Montant" widget="monetary"
                        options="{'currency_field': 'currency_id'}" />
                    <field name="delai_execution" string="Délai" />

                </tree>


            </field>
        </record>


        <record id="post_control_map" model="ir.ui.view">
            <field name="model">project.project</field>
            <field name="arch" type="xml">

                <leaflet_map field_address_id="id" display_name="display_name"
                    field_geolocations="geolocation_ids" />
            </field>
        </record>


        <record
            id="post_control_action" model="ir.actions.act_window">
            <field name="name">Controle a posteriori</field>
            <field name="res_model">project.project</field>
            <field name="context">{'search_default_group_by_autorite_contractante': 1}</field>
            <field name="domain">[]</field>
            <field name="view_mode">tree,kanban,leaflet_map,form</field>
            <field name="view_ids"
                eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('post_control_custom_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('post_control_custom_form')})]" />
            <field name="search_view_id"
                ref="project_customization.view_project_project_filter_custom" />
            <field name="target">main</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No projects found. Let's create one!
                </p>
                <p>
                    Projects contain tasks on the same topic, and each has its own dashboard.
                </p>
            </field>
        </record>

        <!-- Post control-->


        <menuitem name="Control a posteriori" id="post_control_main_item"
            groups="group_post_control_manager"
            sequence="70">
            <menuitem name="Marchés" id="post_control_item" action="post_control_action"
                sequence="1" />

        </menuitem>

        <!--        <menuitem name="Aanalyse" sequence="99" parent="project.menu_main_pm"-->
        <!--                  id="project.menu_project_report"-->
        <!--
        groups="project.group_project_user,project_customization.group_project_supervisor,project_customization.follow_up_manager,project_customization.group_project_invited"/>-->

        <!--        <menuitem name="Marchés" id="project.menu_projects_group_stage"
        parent="project.menu_main_pm"-->
        <!--                  action="project.open_view_project_all_group_stage"-->
        <!--
        groups="project.group_project_manager,project_customization.group_project_invited,project_customization.group_project_supervisor,project_customization.follow_up_manager"-->
        <!--                  sequence="1"/>-->


    </data>
</odoo>