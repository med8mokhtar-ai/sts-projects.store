<?xml version="1.0" encoding="utf-8"?>
<odoo>


    //Menu item and action window for project.realisation Model
    <record id="action_realisation_realisations" model="ir.actions.act_window">
        <field name="name">Realisation</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">project.realisation</field>
        <field name="view_mode">tree,form,pivot,graph,activity,gantt</field>


    </record>


    //realisation_realisations Form view
    <record id="view_realisation_realisations_form" model="ir.ui.view">
        <field name="name">project.realisation.form</field>
        <field name="model">project.realisation</field>
        <field name="arch" type="xml">


            <form>
                <header>

                    <field name="state" widget="statusbar" readonly="1"/>

                    <!-- widget="statusbar" -->
                </header>

                <sheet>
                    <!--                    <div class="container">-->


                    <!--                        <button type="object" name="create_activity" string="Activités" icon="fa-tasks"-->
                    <!--                                widget="mail_activity" class="btn btn-primary float-end"-->

                    <!--                    </div>-->


                    <group>
                        <group>

                            <field name='project_id' readonly="1"/>


                            <label for="start_date" string="Date de réalisation"/>
                            <div name="dates" class="o_row">
                                <div class="col-2">
                                    <field name="start_date" options='{"related_end_date": "end_date"}'
                                           class="oe_form_field_date oe_form_field_sm"/>

                                </div>
                                <div class="col-2">
                                    <i class="fa fa-long-arrow-right " aria-label="Arrow icon" title="Arrow"/>

                                </div>
                                <div class="col-1">

                                    <field name="end_date" options='{"related_start_date": "start_date"}'/>


                                </div>
                                <div class="col-2"></div>


                            </div>


                            <field name='project_achievement' readonly="1"/>


                        </group>
                        <group>
                            <field name='project_manager' readonly="1"/>
                            <field name='current_week_number' readonly="1"/>

                            <field name='project_achievement_befor' readonly="1"/>


                        </group>
                    </group>
                    <notebook>
                        <page name="realisation" string="Réalisation">
                            <field name='realisation' placeholder="Tapez '/' pour les commentaires"
                                   readonly="state == 'close'"/>
                        </page>
                        <page name="observation" string="Observation">
                            <field name='observation' placeholder="Tapez '/' pour les commentaires"
                                   readonly="state == 'close'"/>
                        </page>
                        <page name="observation" string="Obstacles/Décision à prendre">
                            <field name='decision' placeholder="Tapez '/' pour les commentaires"
                                   readonly="state == 'close'"/>
                        </page>
                        <page name="Budget" string="Informations financières">
                            <group>
                                <group name="prevision" string="Prévision">
                                    <field name="currency_id" readonly="1"/>
                                    <field name="project_budget" readonly="1"/>
                                    <field name='funding_mode_ids' widget="many2many_tags"/>

                                    <field name="project_state_budget" readonly="1"/>
                                    <field name="project_ptf_budget" readonly="1"/>
                                    <field name="project_other_budget" readonly="1"/>

                                </group>
                                <group name="execution" string="Execution">

                                    <field name="project_debit" readonly="1"/>

                                </group>

                            </group>


                        </page>
                        <page name="planned_tasks" string="Tâches planifiées">
                            <field name='activity_summary' placeholder="Tapez '/' pour les commentaires"
                                    readonly="state == 'close'"/>
                        </page>

                        <page name="Activity" string="Activités ">


                            <field name="activity_ids" readonly="1">
                                <tree no_open="1">
                                    <field name="activity_type_id" readonly="state == 'close'"/>

                                    <field name="summary" readonly="state == 'close'"/>
                                    <field name="state" readonly="state == 'close'" />
                                    <field name="user_id" readonly="state == 'close'" />


                                </tree>
                            </field>

                        </page>


                    </notebook>


                </sheet>


                <div class="oe_chatter">
                    <field name="message_follower_ids" options="{'post_refresh':True}"
                           help="Follow this project to automatically track the events associated to tasks and issues of this project."
                           groups="base.group_user"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>

            </form>

        </field>
    </record>


    <!-- realisation tree view -->
    <record id="project_realisation_view_tree" model="ir.ui.view">
        <field name="name">project.realisation.view.tree</field>
        <field name="model">project.realisation</field>
        <field name="arch" type="xml">
            <tree string="Realisation list">
                <field name='current_week_number'/>
                <field name='start_date'/>
                <field name='project_id'/>
                <field name='project_manager'/>


                <field name='project_tag' widget="many2many_tags"/>

                <field name='project_budget'/>
                <field name='project_achievement' widget="progressbar_no_rounding"/>
                <field name='project_achievement_befor' widget="progressbar_no_rounding"/>
                <field name='realisation'/>
                <field name='observation'/>
                <field name='decision'/>
                <field name='activity_summary'/>
                <!--                <field name='state'/>-->


            </tree>
        </field>
    </record>


    <!-- realisation filter -->

    <record id="view_project_realisation_filter" model="ir.ui.view">
        <field name="name">project.realisation.filter</field>
        <field name="model">project.realisation</field>
        <field name="arch" type="xml">
            <search string="Project Realisations">
                <!-- <field name="project_name"/> -->
                <field name="project_manager"/>

                <!-- <filter string="Semaine courante" name="filter-current_week" domain="[

                    ('current_week_number', '=', 20),

                    ]" /> -->

                <separator/>

                <filter name="open" string="Semaine courante" domain="[('state', '=', 'open')]"/>
                <filter name="close" string="Semaines précédentes" domain="[('state', '=', 'close')]"/>


                <group expand="0" string="Group By">
                    <filter string="Chef du projet" name="group_by_project_manager" domain="[]"
                            context="{'group_by': 'project_manager'}"/>
                    <filter string="Projet" name="group_by_project" domain="[]" context="{'group_by': 'project_id'}"/>

                    <filter name="Semaine-Mois-Année" string="Date" context="{'group_by': 'start_date'}"/>
                </group>

            </search>
        </field>
    </record>


    <!-- Gantt view -->

    <record model="ir.ui.view" id="realisation_view_gantt">
        <field name="name">project.realisation.view.gantt</field>
        <field name="model">project.realisation</field>
        <field name="arch" type="xml">
            <gantt string="Diagramme gantt" date_start="start_date" date_stop="end_date" default_scale="month"
                   scales="week,month,year" color="state" default_group_by="project_id" total_row="True">
                <templates>
                    <div t-name="gantt-popover">
                        <div t-if="project_manager">
                            <strong>Chef du projet—</strong>
                            <t t-esc="project_manager"/>
                        </div>

                        <div>
                            <t t-esc="userTimezoneStartDate.format('l ')"/>
                            <i class="fa fa-long-arrow-right" title="Arrow"/>
                            <t t-esc="userTimezoneStopDate.format(' l')"/>
                        </div>
                    </div>
                </templates>
                <field name="project_manager"/>
                <!-- <field name="project_name"/> -->


            </gantt>
        </field>
    </record>


<!--Root menu item for the realistion Module
    <menuitem id="root_menu_realisation_realisations" name="Réalisations" parent="project.menu_main_pm"
              action="action_realisation_realisations"/>-->


</odoo>